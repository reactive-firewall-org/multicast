# .ast-grep/multicast-rule-has-module-documentation.yml
utils:
  py_string_literal:
    all:
      - kind: string_content
      - any:
        - all:
            - follows:
                kind: string_start
                regex: (?:'{3})
            - precedes:
                kind: string_end
                regex: (?:'{3})
        - all:
            - follows:
                kind: string_start
                regex: (?:"{3})
            - precedes:
                kind: string_end
                regex: (?:"{3})
        - inside:
            kind: string
  docstring_pattern:
    any:
        - pattern: |
            """$DOC"""
        - pattern: |
            '''$DOC'''
    has:
        matches: py_string_literal
        kind: string_content
    inside:
      kind: expression_statement
  docstring_statement:
    kind: expression_statement
    has:
      matches: docstring_pattern
      inside:
        kind: expression_statement
      kind: string
  module_docstring:
    all:
      - matches: docstring_statement
        inside:
          kind: module
      - kind: expression_statement

id: check-has-module-documentation
rule:
  kind: module
  not:
    has:
      matches: module_docstring
language: python
message: "Module docstring must be present and well formated."
severity: warning
