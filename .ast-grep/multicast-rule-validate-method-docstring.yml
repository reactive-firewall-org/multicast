# .ast-grep/multicast-rule-validate-method-docstring.yml
utils:
  function_docstring:
    all:
      - pattern: |
          """$DOC"""
        inside:
          kind: expression_statement
          inside:
            kind: block
            inside:
              kind: function_definition
      - kind: string
  method_docstring:
    all:
      - pattern: |
          """$DOC"""
        inside:
          kind: expression_statement
          inside:
            kind: block
            inside:
              kind: function_definition
              inside:
                kind: block
                inside:
                  kind: class_definition
      - kind: string
  cep7_docstring_tests:
    all:
      - any:
        - matches: function_docstring
        - matches: method_docstring
      - has:
          regex: |
            .*Testing:.*>>>.+?>>>.*
          kind: string_content
          ends: string_end
      - kind: string

id: validate-method-docstring
rule:
  all:
    - any:
      - matches: function_docstring
      - matches: method_docstring
    - not:
        matches: cep7_docstring_tests
language: python
message: "Method must have docstring with testing examples"
files:
  - multicast/**/*.py
  - multicast/*.py
severity: warning
